import boto3
import os
 
def lambda_handler(event, context):
    # Add the instance id in Environment Variable
    instance_id = os.environ['InstanceId']
    
    # Create an EC2 client object
    ec2 = boto3.client('ec2')
    sns = boto3.client('sns')
    
    # Stop the instance
    ec2.stop_instances(InstanceIds=[instance_id])
    
    # Print a success message
    print('Stopped EC2 instance: ' + instance_id)
    response_sns_ec2_start_stop_status = sns.publish(
        TopicArn=os.environ['SNSTopic'],
        Message="Stopped Bastion instance: " + instance_id, 
        Subject="Cygnature-Staging-Bastion-Server-Status"
    )
